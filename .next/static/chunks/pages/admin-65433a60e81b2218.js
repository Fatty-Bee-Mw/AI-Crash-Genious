(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4730:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(8375)}])},8375:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(5893),i=s(7294);async function r(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function d(){let[e,t]=(0,i.useState)(!1),[s,d]=(0,i.useState)(""),[l,n]=(0,i.useState)(""),[c,o]=(0,i.useState)([]),[m,x]=(0,i.useState)(!1),[h,p]=(0,i.useState)({}),[u,b]=(0,i.useState)([]),[g,f]=(0,i.useState)(""),[j,w]=(0,i.useState)({}),[v,N]=(0,i.useState)([]),[y,C]=(0,i.useState)(""),[A,S]=(0,i.useState)(3),[k,I]=(0,i.useState)(!1),[_,X]=(0,i.useState)(""),[E,D]=(0,i.useState)(!1),[T,O]=(0,i.useState)(""),H=(0,i.useRef)(null);function P(e,t){O(e||"Are you sure?"),H.current=t||null,D(!0)}let R=(0,i.useMemo)(()=>{let e={};for(let t of c)(!e[t.deviceId]||t.createdAt>e[t.deviceId].createdAt)&&(e[t.deviceId]=t);return e},[c]);async function L(){x(!0);try{let e=await fetch("/api/requests"),t=await e.json();o(t.items||[]);let a=await fetch("/api/codes",{headers:{"X-Admin-Code-Hash":l,"X-Admin-Code":s.trim()}}),i=await a.json();N(i.items||[]);let r=await fetch("/api/recipients",{headers:{"X-Admin-Code-Hash":l,"X-Admin-Code":s.trim()}}),d=await r.json();r.ok&&b(Array.isArray(d.items)?d.items:[]),localStorage.setItem("admin_cache",JSON.stringify({items:t.items||[],codes:i.items||[],recipients:Array.isArray(d.items)?d.items:[]}))}catch(e){}x(!1)}async function J(e){p(t=>({...t,[e.id]:!0}));try{let t=await fetch("/api/requests/approve",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()},body:JSON.stringify({id:e.id,deviceId:e.deviceId})}),a=await t.json();t.ok?(w(t=>({...t,[e.id]:a.code})),await L()):X(a.error||"Failed")}catch(e){X("Failed")}p(t=>({...t,[e.id]:!1}))}return((0,i.useEffect)(()=>{e&&L()},[e]),(0,i.useEffect)(()=>{try{let e=localStorage.getItem("admin_cache");if(e){let{items:t,codes:s,recipients:a}=JSON.parse(e);Array.isArray(t)&&o(t),Array.isArray(s)&&N(s),Array.isArray(a)&&b(a)}}catch(e){}},[]),(0,i.useEffect)(()=>{(async()=>{try{let s=localStorage.getItem("admin_code_plain");if(s&&!e){d(s);let e=(s||"").trim(),a=await r(e);if(n(a),"YusufLikagwa@Password"===e){try{localStorage.setItem("admin_session","1")}catch(e){}t(!0)}}}catch(e){}})()},[e]),e)?(0,a.jsxs)("div",{className:"min-h-screen text-white p-6 md:p-10",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between max-w-6xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight text-emerald-300",style:{textShadow:"0 0 10px rgba(16,185,129,0.35)"},children:"Crash AI Genius — Admin"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{try{localStorage.setItem("admin_code_plain",(s||"").trim()),localStorage.setItem("admin_session","1")}catch(e){}window.location.href="/"},className:"px-4 py-2 rounded-lg bg-emerald-600/20 text-emerald-300 border border-emerald-400/30 text-sm",children:"Open Main Dashboard"}),(0,a.jsx)("button",{onClick:async()=>{let e=await fetch("/api/store/export",{headers:{"X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()}}),t=await e.blob(),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download="crash-ai-genius-backup-".concat(Date.now(),".json"),a.click()},className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-sm",children:"Export JSON"}),(0,a.jsxs)("label",{className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-sm cursor-pointer",children:["Import JSON",(0,a.jsx)("input",{type:"file",accept:"application/json",className:"hidden",onChange:async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;I(!0);let i=await a.text();try{await fetch("/api/store/import",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()},body:i}),await L()}catch(e){}I(!1)}})]}),(0,a.jsx)("button",{onClick:L,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-sm",children:m?"Refreshing...":"Refresh"})]})]}),(0,a.jsxs)("section",{className:"max-w-6xl mx-auto mt-6 grid grid-cols-1 md:grid-cols-3 gap-5",children:[(0,a.jsxs)("div",{className:"md:col-span-1 rounded-2xl p-4 border border-emerald-400/20 glass-card",children:[(0,a.jsx)("h2",{className:"font-semibold",children:"Generate Access Code"}),(0,a.jsx)("p",{className:"text-xs text-slate-200/90",children:"Create a 3-day device-locked code manually."}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsx)("label",{className:"text-xs text-slate-200/80",children:"Device ID"}),(0,a.jsx)("input",{value:y,onChange:e=>C(e.target.value),className:"w-full bg-[#0b0f14] text-white caret-white placeholder-white/70 border border-white/15 p-2 rounded-lg",placeholder:"paste device id"}),(0,a.jsx)("label",{className:"text-xs text-slate-200/80",children:"Valid Days"}),(0,a.jsx)("input",{type:"number",value:A,onChange:e=>S(Number(e.target.value)),className:"w-full bg-[#0b0f14] text-white caret-white placeholder-white/70 border border-white/15 p-2 rounded-lg"}),(0,a.jsx)("button",{onClick:async()=>{if(!y)return X("Device ID required");let e=await fetch("/api/codes",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":s},body:JSON.stringify({deviceId:y,ttlMs:864e5*A})}),t=await e.json();e.ok?(C(""),await L(),X("Code: ".concat(t.code))):X(t.error||"Failed")},className:"w-full mt-2 px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 font-semibold",children:"Generate"})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2 rounded-2xl p-4 border border-cyan-400/20 glass-card",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"Active Clients"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[v.map(e=>{let t=function(e){let t=Math.floor(Math.max(0,e-Date.now())/6e4),s=Math.floor(t/60),a=t%60;return s<=0&&a<=0?{label:"Expired",expired:!0}:{label:"".concat(s,"h ").concat(a,"m"),expired:!1}}(e.expiresAt),i=R[e.deviceId],r=(null==i?void 0:i.msisdn)||"",d="Hi".concat(r?" "+r:"",", your Crash AI Genius access will expire in ").concat(t.label,". Please renew to avoid interruption.");return(0,a.jsxs)("div",{className:"p-3 glass-card border border-white/15 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Code"}),(0,a.jsxs)("div",{className:"font-mono text-sm",title:e.codeId||"",children:[(e.codeId||"").slice(0,8),"…"]}),(0,a.jsx)("div",{className:"mt-2 text-[10px] text-slate-300",children:"Device"}),(0,a.jsx)("div",{className:"font-mono text-xs break-all",children:e.deviceId})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Expires"}),(0,a.jsx)("div",{className:"text-xs",children:new Date(e.expiresAt).toLocaleString()}),(0,a.jsx)("div",{className:"".concat(t.expired?"bg-rose-500/15 text-rose-300 border border-rose-400/30":"bg-emerald-500/10 text-emerald-300 border border-emerald-400/30"," mt-1 inline-flex items-center px-2 py-0.5 rounded text-[10px]"),children:t.label})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"text-xs text-slate-200/90",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Phone"}),(0,a.jsx)("div",{className:"font-semibold",children:r||"—"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:async()=>{try{var e;await (null===(e=navigator.clipboard)||void 0===e?void 0:e.writeText(d)),X("Message copied")}catch(e){}},className:"px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-xs",children:"Copy Message"}),(0,a.jsx)("a",{href:"https://wa.me/".concat(r?r.replace(/\D/g,""):"","?text=").concat(encodeURIComponent(d)),target:"_blank",rel:"noreferrer",className:"px-3 py-1.5 rounded-lg bg-emerald-500/15 text-emerald-300 border border-emerald-400/30 text-xs ".concat(r?"":"pointer-events-none opacity-50"),children:"WhatsApp"}),(0,a.jsx)("button",{onClick:()=>{P("Revoke this code?",async()=>{await fetch("/api/codes?code=".concat(encodeURIComponent(e.codeId)),{method:"DELETE",headers:{"X-Admin-Code-Hash":l,"X-Admin-Code":s.trim()}}),await L()})},className:"px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-xs",children:"Revoke"})]})]})]},e.codeId||e.code)}),!v.length&&(0,a.jsx)("div",{className:"text-slate-400 text-sm",children:"No active clients."})]})]}),(0,a.jsxs)("div",{className:"md:col-span-3 rounded-2xl p-4 border border-white/20 glass-card",children:[(0,a.jsx)("h2",{className:"font-semibold mb-2",children:"WhatsApp Recipients"}),(0,a.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-xs text-slate-200/90",children:"Phone Number"}),(0,a.jsx)("input",{value:g,onChange:e=>f(e.target.value),placeholder:"e.g. 0880123456 or 265991234567",className:"mt-1 w-full bg-[#0b0f14] text-white caret-white placeholder-white/70 border border-white/15 p-2 rounded-lg"})]}),(0,a.jsx)("button",{onClick:async()=>{let e=String(g||"").replace(/\D/g,"");if(!e){X("Enter a valid number");return}try{let t=await fetch("/api/recipients",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()},body:JSON.stringify({phone:e})});if(!t.ok){let e=await t.json();X(e.error||"Failed");return}f(""),await L()}catch(e){}},className:"px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 font-semibold",children:"Add"})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[u.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-xl glass-card border border-white/15 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm",children:e.phone}),(0,a.jsx)("div",{className:"text-[11px] text-slate-300",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:async()=>{let t=await fetch("/api/recipients/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()},body:JSON.stringify({enabled:!e.enabled})});if(t.ok)await L();else try{let e=await t.json();X(e.error||"Failed")}catch(e){}},className:"".concat(e.enabled?"bg-emerald-500/15 text-emerald-300 border border-emerald-400/30":"bg-white/10 text-slate-200"," px-3 py-1.5 rounded-lg text-xs"),children:e.enabled?"Enabled":"Disabled"}),(0,a.jsx)("button",{onClick:()=>{P("Remove this recipient?",async()=>{let t=await fetch("/api/recipients/".concat(e.id),{method:"DELETE",headers:{"X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()}});if(t.ok)await L();else try{let e=await t.json();X(e.error||"Failed")}catch(e){}})},className:"px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-xs",children:"Delete"})]})]},e.id)),!u.length&&(0,a.jsx)("div",{className:"text-slate-400",children:"No recipients yet."})]})]})]}),(0,a.jsxs)("main",{className:"max-w-6xl mx-auto mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[c.map(e=>(0,a.jsxs)("div",{className:"rounded-2xl overflow-hidden border border-white/10 glass-card",children:[e.imageBase64&&(0,a.jsx)("img",{src:e.imageBase64,alt:"receipt",className:"w-full h-48 object-cover border-b border-white/10"}),(0,a.jsxs)("div",{className:"p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-300/80",children:[(0,a.jsxs)("span",{children:["ID: ",e.id]}),(0,a.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"glass-card border border-white/10 p-2 rounded-lg",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Provider"}),(0,a.jsx)("div",{className:"font-semibold",children:e.provider||"—"})]}),(0,a.jsxs)("div",{className:"glass-card border border-white/10 p-2 rounded-lg",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Number"}),(0,a.jsx)("div",{className:"font-semibold",children:e.msisdn||"—"})]}),(0,a.jsxs)("div",{className:"glass-card border border-white/10 p-2 rounded-lg col-span-2",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300",children:"Device ID"}),(0,a.jsx)("div",{className:"font-mono text-xs break-all",children:e.deviceId})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,a.jsx)("span",{className:"".concat("approved"===e.status?"border-emerald-400/30 text-emerald-300 bg-emerald-500/10":"border-amber-400/30 text-amber-300 bg-amber-500/10"," text-xs px-2 py-1 rounded-full border"),children:e.status}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[j[e.id]&&(0,a.jsxs)("span",{className:"text-xs bg-emerald-500/15 text-emerald-300 border border-emerald-400/30 px-2 py-1 rounded",children:["Code: ",j[e.id]]}),(0,a.jsx)("button",{disabled:h[e.id],onClick:()=>J(e),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 text-sm font-semibold disabled:opacity-60",children:h[e.id]?"Issuing…":"Approve + Issue Code"})]})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"text-[10px] text-slate-300 mb-1",children:"Notes"}),(0,a.jsx)("textarea",{defaultValue:e.notes||"",placeholder:"Txn refs, confirmations, comments...",className:"w-full h-20 bg-[#0b0f14] text-white caret-white placeholder-white/70 border border-white/10 p-2 rounded-lg text-sm",onBlur:async t=>{let a=t.target.value;await fetch("/api/requests/notes",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Code-Hash":l,"X-Admin-Code":(s||"").trim()},body:JSON.stringify({id:e.id,notes:a})})}})]})]})]},e.id)),!c.length&&!m&&(0,a.jsx)("div",{className:"text-slate-400",children:"No requests yet."})]}),!!_&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[140] flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>X("")}),(0,a.jsxs)("div",{className:"relative w-full max-w-sm rounded-2xl p-6 border border-white/15 glass-card-strong shadow-[0_0_40px_rgba(255,255,255,0.12)]",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Notice"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-200/95",children:_}),(0,a.jsx)("div",{className:"mt-5 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>X(""),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15",children:"Close"})})]})]}),E&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[145] flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/70",onClick:()=>D(!1)}),(0,a.jsxs)("div",{className:"relative w-full max-w-sm rounded-2xl p-6 border border-white/15 glass-card-strong shadow-[0_0_40px_rgba(255,255,255,0.12)]",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Confirm Action"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-200/95",children:T}),(0,a.jsxs)("div",{className:"mt-5 flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>D(!1),className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15",children:"Cancel"}),(0,a.jsx)("button",{onClick:async()=>{try{var e;await (null===(e=H.current)||void 0===e?void 0:e.call(H))}finally{D(!1)}},className:"px-4 py-2 rounded-lg bg-gradient-to-r from-rose-500 to-amber-500 font-semibold",children:"Confirm"})]})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center px-6 text-white",children:(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-2xl p-6 border border-emerald-400/30 glass-card-strong shadow-[0_0_40px_rgba(16,185,129,0.15)]",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Admin Login"}),(0,a.jsx)("p",{className:"text-sm text-slate-200/95 mt-1",children:"Use your universal code to moderate payment requests."}),(0,a.jsx)("input",{value:s,onChange:e=>d(e.target.value),placeholder:"Admin code",className:"mt-4 w-full bg-[#0b0f14] text-white caret-white placeholder-white/70 border border-white/15 p-2 rounded-lg"}),(0,a.jsx)("button",{onClick:async()=>{let e=(s||"").trim();if(n(await r(e)),"YusufLikagwa@Password"===e){try{localStorage.setItem("admin_session","1")}catch(e){}t(!0)}else X("Invalid admin code")},className:"mt-3 w-full px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 font-semibold",children:"Enter"})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4730)}),_N_E=e.O()}]);