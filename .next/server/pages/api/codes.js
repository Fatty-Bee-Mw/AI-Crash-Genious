"use strict";(()=>{var e={};e.id=926,e.ids=[926],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},579:(e,t,n)=>{n.r(t),n.d(t,{config:()=>a,default:()=>c,routeModule:()=>l});var r={};n.r(r),n.d(r,{default:()=>d});var i=n(1802),o=n(7153),s=n(6249),u=n(2600);function d(e,t){let n=e.headers["x-admin-code-hash"],r=e.headers["x-admin-code"],i=process.env.ADMIN_CODE_HASH||"",o=process.env.ADMIN_CODE||"";if(!(i&&n&&n===i||o&&r&&r===o))return t.status(401).json({error:"unauthorized"});if("GET"===e.method)return t.status(200).json({items:(0,u.iY)()});if("POST"===e.method){let{deviceId:n,ttlMs:r}=e.body||{};if(!n)return t.status(400).json({error:"deviceId required"});let i=(0,u.Bu)({deviceId:n,ttlMs:r||2592e5});return t.status(201).json(i)}if("DELETE"===e.method){let{code:n}=e.query||{};return n?(0,u.I7)(n)?t.status(204).end():t.status(404).json({error:"code not found"}):t.status(400).json({error:"code required"})}return t.status(405).json({error:"Method not allowed"})}let c=(0,s.l)(r,"default"),a=(0,s.l)(r,"config"),l=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/codes",pathname:"/api/codes",bundlePath:"",filename:""},userland:r})},2600:(e,t,n)=>{n.d(t,{hP:()=>v,TZ:()=>s,oP:()=>d,_5:()=>E,vM:()=>P,Bu:()=>a,iY:()=>f,TC:()=>m,SW:()=>u,wd:()=>h,I7:()=>p,Yn:()=>g,bY:()=>A,VP:()=>l});let r=require("crypto");var i=n.n(r);let o={requests:[],codes:{},recipients:[]};function s({provider:e,msisdn:t,imageBase64:n,deviceId:r}){let i={id:Math.random().toString(36).slice(2,10).toUpperCase(),createdAt:Date.now(),provider:e||null,msisdn:t||null,imageBase64:n,deviceId:r,status:"pending",notes:""};return o.requests.unshift(i),i}function u(){return o.requests}function d(e){let t=o.requests.findIndex(t=>t.id===e);return -1===t?null:(o.requests[t].status="approved",o.requests[t])}function c(e){return i().createHash("sha256").update(e,"utf8").digest("hex")}function a({deviceId:e,ttlMs:t}){let n=function(e=16){let t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",n=i().randomBytes(e),r="";for(let i=0;i<e;i++)r+=t[n[i]%t.length];return r}(16),r=c(n),s=Date.now()+t;return o.codes[r]={deviceId:e,expiresAt:s},{code:n,codeId:r,expiresAt:s}}function l({code:e,deviceId:t}){let n=c(String(e||"")),r=o.codes[n];return r?r.deviceId!==t?{ok:!1,reason:"Different device"}:r.expiresAt<Date.now()?{ok:!1,reason:"Expired"}:{ok:!0}:{ok:!1,reason:"Code not found"}}function f(){return Object.entries(o.codes).map(([e,t])=>({codeId:e,...t}))}function p(e){let t=o.codes[e]?e:c(String(e||""));return!!o.codes[t]&&(delete o.codes[t],!0)}function P(){return{requests:o.requests,codes:o.codes,recipients:o.recipients,exportedAt:Date.now(),version:1}}function h(e){if(!e||"object"!=typeof e)return!1;let{requests:t,codes:n,recipients:r}=e;return!!Array.isArray(t)&&"object"==typeof n&&(o.requests=t,o.codes=n,o.recipients=Array.isArray(r)?r:[],!0)}function A(e,t){let n=o.requests.find(t=>t.id===e);return n?(n.notes=String(t||"").slice(0,2e3),n):null}function m(){return o.recipients}function v(e){let t={id:Math.random().toString(36).slice(2,10),phone:String(e||"").trim(),enabled:!0,createdAt:Date.now()};return o.recipients.unshift(t),t}function g(e,t){let n=o.recipients.findIndex(t=>t.id===e);if(-1===n)return null;let r={...o.recipients[n]};return t&&"object"==typeof t&&(null!=t.phone&&(r.phone=String(t.phone).trim()),null!=t.enabled&&(r.enabled=!!t.enabled)),o.recipients[n]=r,r}function E(e){let t=o.recipients.findIndex(t=>t.id===e);return -1!==t&&(o.recipients.splice(t,1),!0)}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=579);module.exports=n})();