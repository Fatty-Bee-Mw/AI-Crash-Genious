"use strict";(()=>{var e={};e.id=762,e.ids=[762],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},9297:(e,t,n)=>{n.r(t),n.d(t,{config:()=>m,default:()=>p,routeModule:()=>g});var r={};n.r(r),n.d(r,{default:()=>f});var i=n(1802),o=n(7153),s=n(6249),u=n(2600);let a=new Map,d=new Map;function c(e,t,n){let r=Date.now(),i=e.get(t);return!i||r-i.ts>6e4?(e.set(t,{count:1,ts:r}),!1):(i.count+=1,i.ts=r,e.set(t,i),i.count>n)}function l(e,t=64){return String(e||"").replace(/[<>]/g,"").trim().slice(0,t)}function f(e,t){if("GET"===e.method)return t.status(200).json({items:(0,u.SW)()});if("POST"===e.method){if(c(a,e.headers["x-forwarded-for"]?.split(",")[0]||e.socket.remoteAddress||"unknown",5))return t.status(429).json({error:"Too many requests"});let{provider:n,msisdn:r,imageBase64:i,deviceId:o}=e.body||{};if(!i||!o)return t.status(400).json({error:"imageBase64 and deviceId required"});if(!/^[a-f0-9]{32}$/i.test(o))return t.status(400).json({error:"invalid deviceId format"});if(c(d,o,3))return t.status(429).json({error:"Too many requests"});let s=/^data:(image\/(png|jpeg|jpg));base64,([A-Za-z0-9+/=]+)$/.exec(i||"");if(!s)return t.status(400).json({error:"invalid image"});if(Math.floor(3*s[3].length/4)>3145728)return t.status(400).json({error:"image too large (max 3MB)"});let f=(0,u.TZ)({provider:l(n,32),msisdn:l(r,32),imageBase64:i,deviceId:o});return t.status(201).json({item:f})}return t.status(405).json({error:"Method not allowed"})}let p=(0,s.l)(r,"default"),m=(0,s.l)(r,"config"),g=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/requests",pathname:"/api/requests",bundlePath:"",filename:""},userland:r})},2600:(e,t,n)=>{n.d(t,{hP:()=>h,TZ:()=>s,oP:()=>a,_5:()=>j,vM:()=>m,Bu:()=>c,iY:()=>f,TC:()=>A,SW:()=>u,wd:()=>g,I7:()=>p,Yn:()=>v,bY:()=>P,VP:()=>l});let r=require("crypto");var i=n.n(r);let o={requests:[],codes:{},recipients:[]};function s({provider:e,msisdn:t,imageBase64:n,deviceId:r}){let i={id:Math.random().toString(36).slice(2,10).toUpperCase(),createdAt:Date.now(),provider:e||null,msisdn:t||null,imageBase64:n,deviceId:r,status:"pending",notes:""};return o.requests.unshift(i),i}function u(){return o.requests}function a(e){let t=o.requests.findIndex(t=>t.id===e);return -1===t?null:(o.requests[t].status="approved",o.requests[t])}function d(e){return i().createHash("sha256").update(e,"utf8").digest("hex")}function c({deviceId:e,ttlMs:t}){let n=function(e=16){let t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",n=i().randomBytes(e),r="";for(let i=0;i<e;i++)r+=t[n[i]%t.length];return r}(16),r=d(n),s=Date.now()+t;return o.codes[r]={deviceId:e,expiresAt:s},{code:n,codeId:r,expiresAt:s}}function l({code:e,deviceId:t}){let n=d(String(e||"")),r=o.codes[n];return r?r.deviceId!==t?{ok:!1,reason:"Different device"}:r.expiresAt<Date.now()?{ok:!1,reason:"Expired"}:{ok:!0}:{ok:!1,reason:"Code not found"}}function f(){return Object.entries(o.codes).map(([e,t])=>({codeId:e,...t}))}function p(e){let t=o.codes[e]?e:d(String(e||""));return!!o.codes[t]&&(delete o.codes[t],!0)}function m(){return{requests:o.requests,codes:o.codes,recipients:o.recipients,exportedAt:Date.now(),version:1}}function g(e){if(!e||"object"!=typeof e)return!1;let{requests:t,codes:n,recipients:r}=e;return!!Array.isArray(t)&&"object"==typeof n&&(o.requests=t,o.codes=n,o.recipients=Array.isArray(r)?r:[],!0)}function P(e,t){let n=o.requests.find(t=>t.id===e);return n?(n.notes=String(t||"").slice(0,2e3),n):null}function A(){return o.recipients}function h(e){let t={id:Math.random().toString(36).slice(2,10),phone:String(e||"").trim(),enabled:!0,createdAt:Date.now()};return o.recipients.unshift(t),t}function v(e,t){let n=o.recipients.findIndex(t=>t.id===e);if(-1===n)return null;let r={...o.recipients[n]};return t&&"object"==typeof t&&(null!=t.phone&&(r.phone=String(t.phone).trim()),null!=t.enabled&&(r.enabled=!!t.enabled)),o.recipients[n]=r,r}function j(e){let t=o.recipients.findIndex(t=>t.id===e);return -1!==t&&(o.recipients.splice(t,1),!0)}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=9297);module.exports=n})();