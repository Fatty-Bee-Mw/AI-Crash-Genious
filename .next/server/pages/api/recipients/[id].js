"use strict";(()=>{var e={};e.id=837,e.ids=[837],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},1861:(e,t,n)=>{n.r(t),n.d(t,{config:()=>c,default:()=>a,routeModule:()=>l});var r={};n.r(r),n.d(r,{default:()=>d});var i=n(1802),o=n(7153),s=n(6249),u=n(2600);function d(e,t){let n=e.headers["x-admin-code-hash"],r=e.headers["x-admin-code"],i=process.env.ADMIN_CODE_HASH||"",o=process.env.ADMIN_CODE||"";if(!(i&&n&&n===i||o&&r&&r===o))return t.status(401).json({error:"unauthorized"});let{id:s}=e.query||{};if(!s)return t.status(400).json({error:"missing id"});if("GET"===e.method){let e=((0,u.TC)()||[]).find(e=>e.id===s);return e?t.status(200).json({item:e}):t.status(404).json({error:"not found"})}if("PATCH"===e.method)try{let n=e.body||{},r=(0,u.Yn)(s,n);if(!r)return t.status(404).json({error:"not found"});return t.status(200).json({item:r})}catch{return t.status(400).json({error:"bad request"})}return"DELETE"===e.method?(0,u._5)(s)?t.status(200).json({ok:!0}):t.status(404).json({error:"not found"}):t.status(405).json({error:"Method not allowed"})}let a=(0,s.l)(r,"default"),c=(0,s.l)(r,"config"),l=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/recipients/[id]",pathname:"/api/recipients/[id]",bundlePath:"",filename:""},userland:r})},2600:(e,t,n)=>{n.d(t,{hP:()=>g,TZ:()=>s,oP:()=>d,_5:()=>b,vM:()=>h,Bu:()=>c,iY:()=>f,TC:()=>m,SW:()=>u,wd:()=>A,I7:()=>p,Yn:()=>j,bY:()=>P,VP:()=>l});let r=require("crypto");var i=n.n(r);let o={requests:[],codes:{},recipients:[]};function s({provider:e,msisdn:t,imageBase64:n,deviceId:r}){let i={id:Math.random().toString(36).slice(2,10).toUpperCase(),createdAt:Date.now(),provider:e||null,msisdn:t||null,imageBase64:n,deviceId:r,status:"pending",notes:""};return o.requests.unshift(i),i}function u(){return o.requests}function d(e){let t=o.requests.findIndex(t=>t.id===e);return -1===t?null:(o.requests[t].status="approved",o.requests[t])}function a(e){return i().createHash("sha256").update(e,"utf8").digest("hex")}function c({deviceId:e,ttlMs:t}){let n=function(e=16){let t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",n=i().randomBytes(e),r="";for(let i=0;i<e;i++)r+=t[n[i]%t.length];return r}(16),r=a(n),s=Date.now()+t;return o.codes[r]={deviceId:e,expiresAt:s},{code:n,codeId:r,expiresAt:s}}function l({code:e,deviceId:t}){let n=a(String(e||"")),r=o.codes[n];return r?r.deviceId!==t?{ok:!1,reason:"Different device"}:r.expiresAt<Date.now()?{ok:!1,reason:"Expired"}:{ok:!0}:{ok:!1,reason:"Code not found"}}function f(){return Object.entries(o.codes).map(([e,t])=>({codeId:e,...t}))}function p(e){let t=o.codes[e]?e:a(String(e||""));return!!o.codes[t]&&(delete o.codes[t],!0)}function h(){return{requests:o.requests,codes:o.codes,recipients:o.recipients,exportedAt:Date.now(),version:1}}function A(e){if(!e||"object"!=typeof e)return!1;let{requests:t,codes:n,recipients:r}=e;return!!Array.isArray(t)&&"object"==typeof n&&(o.requests=t,o.codes=n,o.recipients=Array.isArray(r)?r:[],!0)}function P(e,t){let n=o.requests.find(t=>t.id===e);return n?(n.notes=String(t||"").slice(0,2e3),n):null}function m(){return o.recipients}function g(e){let t={id:Math.random().toString(36).slice(2,10),phone:String(e||"").trim(),enabled:!0,createdAt:Date.now()};return o.recipients.unshift(t),t}function j(e,t){let n=o.recipients.findIndex(t=>t.id===e);if(-1===n)return null;let r={...o.recipients[n]};return t&&"object"==typeof t&&(null!=t.phone&&(r.phone=String(t.phone).trim()),null!=t.enabled&&(r.enabled=!!t.enabled)),o.recipients[n]=r,r}function b(e){let t=o.recipients.findIndex(t=>t.id===e);return -1!==t&&(o.recipients.splice(t,1),!0)}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=1861);module.exports=n})();